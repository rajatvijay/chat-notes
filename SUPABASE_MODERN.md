# Modern Supabase CLI Workflow

## ğŸ”„ Updated Commands (2024)

The Supabase CLI has evolved. Here are the current best practices:

### **Database Operations**

```bash
# âŒ OBSOLETE: supabase db seed
# âœ… MODERN: supabase db reset

# Reset local database (applies migrations + seed.sql)
supabase db reset

# Push schema to remote database
supabase db push

# Pull schema from remote to local
supabase db pull
```

### **File Structure (Modern)**

```
supabase/
â”œâ”€â”€ config.toml              # Generated by `supabase init`
â”œâ”€â”€ seed.sql                 # Seed data (replaces seed/ directory)
â””â”€â”€ migrations/              # Schema versions
    â””â”€â”€ 001_initial_schema.sql
```

### **How Seeding Works Now**

1. **`supabase db reset`** does:
   - Drops all tables
   - Applies all migrations in order
   - Runs `supabase/seed.sql` automatically

2. **`supabase/seed.sql`** contains:
   - Sample data for development
   - Uses `ON CONFLICT DO NOTHING` for safety
   - Runs after all migrations

### **Development Workflow**

```bash
# 1. One-time setup
supabase init                # Creates config.toml
supabase link --project-ref loxrqhuyckjrmkdddmlt

# 2. Daily development
supabase start              # Start local stack
supabase db reset           # Reset with fresh data

# 3. Schema changes
# Edit migration files
supabase db push            # Push to remote
# Or
supabase db reset --db-url YOUR_REMOTE_URL  # Reset remote
```

### **Environment Variables**

For local development with `supabase start`:

```bash
# apps/web/.env.local
VITE_SUPABASE_URL=http://localhost:54321
VITE_SUPABASE_ANON_KEY=<local_anon_key_from_supabase_status>
```

Get the local anon key with:
```bash
supabase status
```

### **Why the Change?**

- **Simpler**: One `seed.sql` file instead of directory structure
- **Atomic**: `db reset` ensures clean state every time
- **Consistent**: Same behavior in local and CI/CD
- **Modern**: Follows current Supabase CLI patterns

### **Migration from Old CLI**

If you have old `seed/` directories:

```bash
# Consolidate seed files
cat supabase/seed/*.sql > supabase/seed.sql

# Remove old directory
rm -rf supabase/seed/

# Test the new workflow
supabase db reset
```

### **Package.json Scripts (Updated)**

```json
{
  "scripts": {
    "db:migrate": "supabase db push",
    "db:reset": "supabase db reset",
    "supabase:status": "supabase status"
  }
}
```

### **Common Tasks**

```bash
# Add sample data for testing
pnpm db:reset

# Deploy schema changes
pnpm db:migrate

# Check what's running locally
pnpm supabase:status

# View local dashboard
open http://localhost:54323
```

This modern approach is much cleaner and more reliable! ğŸš€